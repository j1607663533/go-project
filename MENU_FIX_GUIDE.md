# èœå•å­èœå•æ˜¾ç¤ºé—®é¢˜ - è§£å†³æ–¹æ¡ˆ

## ğŸ› é—®é¢˜æè¿°

å‰ç«¯ç³»ç»Ÿç®¡ç†å­èœå•ï¼Œåç«¯æ¥å£æœ‰è¿”å›æ•°æ®ï¼Œä½†å‰ç«¯æ²¡æœ‰æ˜¾ç¤ºã€‚

## ğŸ” é—®é¢˜åŸå› 

åç«¯ `BuildMenuTree` å‡½æ•°åœ¨æ„å»ºæ ‘å½¢ç»“æ„æ—¶å­˜åœ¨é€»è¾‘é”™è¯¯ï¼š

- ä½¿ç”¨äº†å€¼å¤åˆ¶è€Œä¸æ˜¯æŒ‡é’ˆå¼•ç”¨
- å¯¼è‡´å­èœå•æ·»åŠ åˆ°çˆ¶èœå•æ—¶ï¼Œå®é™…ä¿®æ”¹çš„æ˜¯å‰¯æœ¬è€Œä¸æ˜¯åŸå¯¹è±¡
- æœ€ç»ˆè¿”å›çš„æ ‘å½¢ç»“æ„ä¸­ï¼Œçˆ¶èœå•çš„ `children` æ•°ç»„ä¸ºç©º

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤åç«¯ä»£ç 

å·²ä¿®å¤ `backend/repositories/menu_repository.go` ä¸­çš„ `BuildMenuTree` å‡½æ•°ï¼š

**ä¿®æ”¹å‰**:

```go
var roots []models.MenuTreeResponse
// ...
roots = append(roots, *menuMap[menu.ID])  // å€¼å¤åˆ¶
```

**ä¿®æ”¹å**:

```go
var roots []*models.MenuTreeResponse
// ...
roots = append(roots, menuMap[menu.ID])  // æŒ‡é’ˆå¼•ç”¨
// æœ€åè½¬æ¢ä¸ºå€¼ç±»å‹è¿”å›
result := make([]models.MenuTreeResponse, len(roots))
for i, root := range roots {
    result[i] = *root
}
return result
```

### 2. é‡å¯åç«¯æœåŠ¡

ä¿®æ”¹ä»£ç åéœ€è¦é‡å¯åç«¯ï¼š

```bash
cd backend
go run main.go
```

### 3. é‡æ–°ç™»å½•

ç”±äºèœå•æ•°æ®åœ¨ç™»å½•æ—¶è·å–å¹¶ä¿å­˜åˆ° localStorageï¼Œéœ€è¦ï¼š

1. é€€å‡ºç™»å½•
2. é‡æ–°ç™»å½•
3. æ–°çš„èœå•æ•°æ®ï¼ˆåŒ…å«å­èœå•ï¼‰ä¼šè¢«åŠ è½½

## ğŸ”§ è°ƒè¯•å·¥å…·

å·²åˆ›å»ºèœå•è°ƒè¯•é¡µé¢ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰çš„èœå•æ•°æ®ï¼š

**è®¿é—®åœ°å€**: `http://localhost:5173/debug`

**åŠŸèƒ½**:

- æ˜¾ç¤ºèœå•æ•°é‡
- æ˜¾ç¤ºåŸå§‹ JSON æ•°æ®
- æ˜¾ç¤ºæ ‘å½¢ç»“æ„
- åˆ·æ–°æŒ‰é’®

## ğŸ“‹ éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥åç«¯è¿”å›

ç™»å½•æ—¶æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Network æ ‡ç­¾ï¼š

- æ‰¾åˆ° `/api/v1/login` è¯·æ±‚
- æŸ¥çœ‹å“åº”ä¸­çš„ `menus` å­—æ®µ
- ç¡®è®¤æ˜¯å¦åŒ…å« `children` æ•°ç»„

**æ­£ç¡®çš„å“åº”ç¤ºä¾‹**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "token": "...",
    "user": {...},
    "menus": [
      {
        "id": 1,
        "name": "é¦–é¡µ",
        "path": "/",
        "children": []
      },
      {
        "id": 3,
        "name": "ç³»ç»Ÿç®¡ç†",
        "path": "/system",
        "children": [
          {
            "id": 4,
            "name": "ç”¨æˆ·ç®¡ç†",
            "path": "/system/users",
            "children": []
          },
          {
            "id": 5,
            "name": "è§’è‰²ç®¡ç†",
            "path": "/system/roles",
            "children": []
          },
          {
            "id": 6,
            "name": "èœå•ç®¡ç†",
            "path": "/system/menus",
            "children": []
          }
        ]
      }
    ]
  }
}
```

### 2. æ£€æŸ¥ localStorage

åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
JSON.parse(localStorage.getItem("menus"));
```

åº”è¯¥èƒ½çœ‹åˆ°åŒ…å«å­èœå•çš„æ•°æ®ã€‚

### 3. ä½¿ç”¨è°ƒè¯•é¡µé¢

è®¿é—® `http://localhost:5173/debug` æŸ¥çœ‹ï¼š

- èœå•æ•°é‡åº”è¯¥ > 0
- æ ‘å½¢ç»“æ„åº”è¯¥æ˜¾ç¤ºçˆ¶å­å…³ç³»
- ç³»ç»Ÿç®¡ç†ä¸‹åº”è¯¥æœ‰ 3 ä¸ªå­èœå•

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤åï¼Œç™»å½•ç³»ç»Ÿåº”è¯¥çœ‹åˆ°ï¼š

```
â”œâ”€ é¦–é¡µ
â”œâ”€ è®¢å•ç®¡ç†
â””â”€ ç³»ç»Ÿç®¡ç† (å¯å±•å¼€)
   â”œâ”€ ç”¨æˆ·ç®¡ç†
   â”œâ”€ è§’è‰²ç®¡ç†
   â””â”€ èœå•ç®¡ç†
```

## ğŸ”„ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

### 1. æ¸…é™¤ç¼“å­˜

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
localStorage.clear();
location.reload();
```

### 2. æ£€æŸ¥æ•°æ®åº“

```sql
USE projecttest;

-- æŸ¥çœ‹èœå•
SELECT id, parent_id, name, path FROM menus ORDER BY parent_id, sort;

-- æŸ¥çœ‹è§’è‰²èœå•å…³è”
SELECT r.name as role_name, m.name as menu_name
FROM role_menus rm
JOIN roles r ON rm.role_id = r.id
JOIN menus m ON rm.menu_id = m.id
WHERE r.id = 1
ORDER BY m.id;
```

### 3. é‡æ–°åˆå§‹åŒ–æ•°æ®

```bash
cd backend
mysql -u root -p projecttest < init_data.sql
```

### 4. æ£€æŸ¥ç”¨æˆ·è§’è‰²

```sql
-- ç¡®è®¤ä½ çš„ç”¨æˆ·æ˜¯è¶…çº§ç®¡ç†å‘˜
SELECT id, username, role_id FROM users WHERE username = 'your_username';

-- å¦‚æœä¸æ˜¯ï¼Œè®¾ç½®ä¸ºè¶…çº§ç®¡ç†å‘˜
UPDATE users SET role_id = 1 WHERE username = 'your_username';
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **åç«¯ä¿®æ”¹åå¿…é¡»é‡å¯**

   - ä¿®æ”¹ Go ä»£ç åï¼Œå¿…é¡»é‡å¯ `go run main.go`

2. **å‰ç«¯éœ€è¦é‡æ–°ç™»å½•**

   - èœå•æ•°æ®åœ¨ç™»å½•æ—¶è·å–
   - ä¿®æ”¹åç«¯åï¼Œéœ€è¦é‡æ–°ç™»å½•æ‰èƒ½è·å–æ–°æ•°æ®

3. **æ£€æŸ¥è§’è‰²æƒé™**

   - ç¡®ä¿ç”¨æˆ·æ˜¯è¶…çº§ç®¡ç†å‘˜ï¼ˆrole_id = 1ï¼‰
   - æ™®é€šç”¨æˆ·çœ‹ä¸åˆ°ç³»ç»Ÿç®¡ç†èœå•

4. **çˆ¶èœå•ä¸è·³è½¬**
   - ç‚¹å‡»"ç³»ç»Ÿç®¡ç†"åªä¼šå±•å¼€ï¼Œä¸ä¼šè·³è½¬
   - ç‚¹å‡»å­èœå•ï¼ˆç”¨æˆ·ç®¡ç†ç­‰ï¼‰æ‰ä¼šè·³è½¬

## ğŸ‰ æ€»ç»“

é—®é¢˜å·²ä¿®å¤ï¼æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. âœ… åç«¯ä»£ç å·²ä¿®å¤
2. âœ… é‡å¯åç«¯æœåŠ¡
3. âœ… é€€å‡ºç™»å½•
4. âœ… é‡æ–°ç™»å½•
5. âœ… æŸ¥çœ‹èœå•ï¼ˆåº”è¯¥èƒ½çœ‹åˆ°å­èœå•äº†ï¼‰

å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œä½¿ç”¨è°ƒè¯•é¡µé¢ `/debug` æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚
