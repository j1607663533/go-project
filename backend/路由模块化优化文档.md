# åç«¯è·¯ç”±æ¨¡å—åŒ–ä¼˜åŒ–æ–‡æ¡£

## ğŸ“‹ ä¼˜åŒ–æ¦‚è¿°

å·²æˆåŠŸå°†åç«¯è·¯ç”±æŒ‰ç…§ä¸åŒæ¨¡å—è¿›è¡Œåˆ†ç¦»ï¼Œæé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## ğŸ—‚ï¸ æ–‡ä»¶ç»“æ„

### ä¼˜åŒ–å‰

```
backend/routes/
â””â”€â”€ routes.go (æ‰€æœ‰è·¯ç”±éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œ87 è¡Œ)
```

### ä¼˜åŒ–å

```
backend/routes/
â”œâ”€â”€ routes.go           # ä¸»è·¯ç”±æ–‡ä»¶ï¼ˆæ•´åˆæ‰€æœ‰æ¨¡å—ï¼‰
â”œâ”€â”€ auth_routes.go      # è®¤è¯ç›¸å…³è·¯ç”±
â”œâ”€â”€ user_routes.go      # ç”¨æˆ·ç›¸å…³è·¯ç”±
â””â”€â”€ order_routes.go     # è®¢å•ç›¸å…³è·¯ç”±
```

## ğŸ“‚ å„æ–‡ä»¶è¯¦ç»†è¯´æ˜

### 1. `routes.go` - ä¸»è·¯ç”±æ–‡ä»¶

**èŒè´£**:

- åˆå§‹åŒ–ä¾èµ–æ³¨å…¥ï¼ˆRepository â†’ Service â†’ Controllerï¼‰
- è®¾ç½®å…¨å±€ä¸­é—´ä»¶ï¼ˆCORSï¼‰
- åˆ›å»º API è·¯ç”±ç»„
- è°ƒç”¨å„æ¨¡å—è·¯ç”±è®¾ç½®å‡½æ•°

**ä»£ç ç»“æ„**:

```go
func SetupRouter(db *gorm.DB) *gin.Engine {
    // 1. åˆ›å»º Gin å¼•æ“
    r := gin.Default()

    // 2. è®¾ç½®å…¨å±€ä¸­é—´ä»¶
    r.Use(middlewares.CORS())

    // 3. ä¾èµ–æ³¨å…¥ï¼ˆRepository â†’ Service â†’ Controllerï¼‰
    userRepo := repositories.NewUserRepository(db)
    orderRepo := repositories.NewOrderRepository(db)

    userService := services.NewUserService(userRepo)
    orderService := services.NewOrderService(orderRepo)

    userController := controllers.NewUserController(userService)
    orderController := controllers.NewOrderController(orderService)
    captchaController := controllers.NewCaptchaController()

    // 4. å¥åº·æ£€æŸ¥ç«¯ç‚¹
    r.GET("/health", healthCheckHandler)

    // 5. API è·¯ç”±ç»„
    api := r.Group("/api/v1")

    // 6. è®¾ç½®å„æ¨¡å—è·¯ç”±
    SetupAuthRoutes(api, userController, captchaController)
    SetupUserRoutes(api, userController)
    SetupOrderRoutes(api, orderController)

    return r
}
```

### 2. `auth_routes.go` - è®¤è¯è·¯ç”±æ¨¡å—

**èŒè´£**: å¤„ç†æ‰€æœ‰è®¤è¯ç›¸å…³çš„è·¯ç”±

**åŒ…å«çš„ç«¯ç‚¹**:

```go
// å…¬å¼€ç«¯ç‚¹ï¼ˆä¸éœ€è¦è®¤è¯ï¼‰
GET  /api/v1/captcha          # è·å–éªŒè¯ç 
POST /api/v1/captcha/verify   # éªŒè¯éªŒè¯ç 
POST /api/v1/register         # ç”¨æˆ·æ³¨å†Œ
POST /api/v1/login            # ç”¨æˆ·ç™»å½•
POST /api/v1/logout           # ç”¨æˆ·é€€å‡ºç™»å½•

// éœ€è¦è®¤è¯çš„ç«¯ç‚¹
GET  /api/v1/auth/profile     # è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
```

**å‡½æ•°ç­¾å**:

```go
func SetupAuthRoutes(
    api *gin.RouterGroup,
    userController *controllers.UserController,
    captchaController *controllers.CaptchaController
)
```

### 3. `user_routes.go` - ç”¨æˆ·è·¯ç”±æ¨¡å—

**èŒè´£**: å¤„ç†æ‰€æœ‰ç”¨æˆ·ç®¡ç†ç›¸å…³çš„è·¯ç”±

**åŒ…å«çš„ç«¯ç‚¹**:

```go
// æ‰€æœ‰ç«¯ç‚¹éƒ½éœ€è¦è®¤è¯ï¼ˆé™¤äº† POST åˆ›å»ºç”¨æˆ·ï¼‰
GET    /api/v1/users          # è·å–ç”¨æˆ·åˆ—è¡¨
GET    /api/v1/users/:id      # è·å–å•ä¸ªç”¨æˆ·
POST   /api/v1/users          # åˆ›å»ºç”¨æˆ·
PUT    /api/v1/users/:id      # æ›´æ–°ç”¨æˆ·
DELETE /api/v1/users/:id      # åˆ é™¤ç”¨æˆ·
```

**å‡½æ•°ç­¾å**:

```go
func SetupUserRoutes(
    api *gin.RouterGroup,
    userController *controllers.UserController
)
```

### 4. `order_routes.go` - è®¢å•è·¯ç”±æ¨¡å—

**èŒè´£**: å¤„ç†æ‰€æœ‰è®¢å•ç›¸å…³çš„è·¯ç”±

**åŒ…å«çš„ç«¯ç‚¹**:

```go
// æ‰€æœ‰ç«¯ç‚¹éƒ½éœ€è¦è®¤è¯
GET  /api/v1/orders/list      # è·å–è®¢å•åˆ—è¡¨
GET  /api/v1/orders/:id       # è·å–è®¢å•è¯¦æƒ…
POST /api/v1/orders           # åˆ›å»ºè®¢å•
```

**å‡½æ•°ç­¾å**:

```go
func SetupOrderRoutes(
    api *gin.RouterGroup,
    orderController *controllers.OrderController
)
```

## ğŸ¯ ä¼˜åŒ–ä¼˜åŠ¿

### 1. **æ¨¡å—åŒ–æ¸…æ™°**

- âœ… æ¯ä¸ªæ¨¡å—ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„è·¯ç”±
- âœ… èŒè´£å•ä¸€ï¼Œæ˜“äºç†è§£
- âœ… æ–°å¢æ¨¡å—åªéœ€åˆ›å»ºæ–°æ–‡ä»¶

### 2. **æ˜“äºç»´æŠ¤**

- âœ… ä¿®æ”¹æŸä¸ªæ¨¡å—çš„è·¯ç”±ä¸å½±å“å…¶ä»–æ¨¡å—
- âœ… ä»£ç é‡å‡å°‘ï¼Œæ¯ä¸ªæ–‡ä»¶æ›´ç®€æ´
- âœ… å‡å°‘ä»£ç å†²çªçš„å¯èƒ½æ€§

### 3. **å¯æ‰©å±•æ€§å¼º**

- âœ… æ–°å¢æ¨¡å—åªéœ€ï¼š
  1. åˆ›å»º `xxx_routes.go`
  2. åœ¨ `routes.go` ä¸­è°ƒç”¨ `SetupXxxRoutes()`
- âœ… æ˜“äºæ·»åŠ æ–°çš„ä¸­é—´ä»¶
- âœ… æ˜“äºè°ƒæ•´è·¯ç”±ç»“æ„

### 4. **å›¢é˜Ÿåä½œå‹å¥½**

- âœ… ä¸åŒå¼€å‘è€…å¯ä»¥å¹¶è¡Œå¼€å‘ä¸åŒæ¨¡å—
- âœ… ä»£ç å®¡æŸ¥æ›´å®¹æ˜“
- âœ… å‡å°‘åˆå¹¶å†²çª

## ğŸ“Š è·¯ç”±ç»“æ„å¯¹æ¯”

### ä¼˜åŒ–å‰ï¼ˆå•æ–‡ä»¶ï¼‰

```
routes.go (87 è¡Œ)
â”œâ”€â”€ ä¾èµ–æ³¨å…¥
â”œâ”€â”€ éªŒè¯ç è·¯ç”±
â”œâ”€â”€ è®¤è¯è·¯ç”±
â”œâ”€â”€ ç”¨æˆ·è·¯ç”±
â”œâ”€â”€ è®¢å•è·¯ç”±
â””â”€â”€ å…¶ä»–...
```

### ä¼˜åŒ–åï¼ˆæ¨¡å—åŒ–ï¼‰

```
routes.go (50 è¡Œ)
â”œâ”€â”€ ä¾èµ–æ³¨å…¥
â””â”€â”€ è°ƒç”¨å„æ¨¡å—è·¯ç”±

auth_routes.go (27 è¡Œ)
â””â”€â”€ è®¤è¯ç›¸å…³è·¯ç”±

user_routes.go (25 è¡Œ)
â””â”€â”€ ç”¨æˆ·ç›¸å…³è·¯ç”±

order_routes.go (21 è¡Œ)
â””â”€â”€ è®¢å•ç›¸å…³è·¯ç”±
```

## ğŸ”„ å¦‚ä½•æ·»åŠ æ–°æ¨¡å—

å‡è®¾è¦æ·»åŠ  "äº§å“ç®¡ç†" æ¨¡å—ï¼š

### æ­¥éª¤ 1: åˆ›å»ºè·¯ç”±æ–‡ä»¶

åˆ›å»º `backend/routes/product_routes.go`:

```go
package routes

import (
    "gin-backend/controllers"
    "gin-backend/middlewares"
    "github.com/gin-gonic/gin"
)

func SetupProductRoutes(api *gin.RouterGroup, productController *controllers.ProductController) {
    products := api.Group("/products")
    products.Use(middlewares.AuthMiddleware())
    {
        products.GET("", productController.GetProducts)
        products.GET("/:id", productController.GetProduct)
        products.POST("", productController.CreateProduct)
        products.PUT("/:id", productController.UpdateProduct)
        products.DELETE("/:id", productController.DeleteProduct)
    }
}
```

### æ­¥éª¤ 2: åœ¨ä¸»è·¯ç”±æ–‡ä»¶ä¸­æ³¨å†Œ

åœ¨ `routes.go` ä¸­æ·»åŠ ï¼š

```go
// åˆå§‹åŒ– product controller
productRepo := repositories.NewProductRepository(db)
productService := services.NewProductService(productRepo)
productController := controllers.NewProductController(productService)

// æ³¨å†Œè·¯ç”±
SetupProductRoutes(api, productController)
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. ç¼–è¯‘æµ‹è¯•

```bash
cd backend
go build .
```

âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯

### 2. è¿è¡Œæµ‹è¯•

```bash
go run main.go
```

âœ… æœåŠ¡å¯åŠ¨æˆåŠŸ

### 3. ç«¯ç‚¹æµ‹è¯•

æ‰€æœ‰ç°æœ‰ç«¯ç‚¹åŠŸèƒ½æ­£å¸¸ï¼š

- âœ… `GET /health` - å¥åº·æ£€æŸ¥
- âœ… `GET /api/v1/captcha` - è·å–éªŒè¯ç 
- âœ… `POST /api/v1/login` - ç”¨æˆ·ç™»å½•
- âœ… `POST /api/v1/logout` - ç”¨æˆ·é€€å‡º
- âœ… `GET /api/v1/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- âœ… `GET /api/v1/orders/list` - è·å–è®¢å•åˆ—è¡¨

## ğŸ“ æœ€ä½³å®è·µ

### 1. è·¯ç”±å‘½åè§„èŒƒ

```go
// âœ… å¥½çš„å‘½å
SetupAuthRoutes()
SetupUserRoutes()
SetupOrderRoutes()

// âŒ ä¸å¥½çš„å‘½å
AuthRouter()
UserSetup()
OrdersInit()
```

### 2. ä¸­é—´ä»¶ä½¿ç”¨

```go
// âœ… åœ¨è·¯ç”±ç»„çº§åˆ«åº”ç”¨ä¸­é—´ä»¶
users := api.Group("/users")
users.Use(middlewares.AuthMiddleware())
{
    users.GET("", controller.GetUsers)
}

// âŒ åœ¨æ¯ä¸ªè·¯ç”±ä¸Šå•ç‹¬åº”ç”¨
users.GET("", middlewares.AuthMiddleware(), controller.GetUsers)
```

### 3. è·¯ç”±åˆ†ç»„

```go
// âœ… æŒ‰åŠŸèƒ½åˆ†ç»„
auth := api.Group("/auth")
users := api.Group("/users")
orders := api.Group("/orders")

// âŒ æ‰å¹³åŒ–è·¯ç”±
api.GET("/auth-profile", ...)
api.GET("/user-list", ...)
api.GET("/order-list", ...)
```

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™æ¬¡è·¯ç”±æ¨¡å—åŒ–ä¼˜åŒ–ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

1. âœ… **ä»£ç ç»„ç»‡æ›´æ¸…æ™°** - æ¯ä¸ªæ¨¡å—ç‹¬ç«‹ç®¡ç†
2. âœ… **ç»´æŠ¤æ›´å®¹æ˜“** - ä¿®æ”¹å½±å“èŒƒå›´å°
3. âœ… **æ‰©å±•æ›´ç®€å•** - æ–°å¢æ¨¡å—åªéœ€åˆ›å»ºæ–°æ–‡ä»¶
4. âœ… **å›¢é˜Ÿåä½œæ›´å‹å¥½** - å‡å°‘ä»£ç å†²çª
5. âœ… **ä»£ç å¤ç”¨æ€§æ›´é«˜** - è·¯ç”±è®¾ç½®å‡½æ•°å¯å¤ç”¨

ç°åœ¨çš„è·¯ç”±ç»“æ„æ›´åŠ ä¸“ä¸šå’Œè§„èŒƒï¼Œç¬¦åˆå¤§å‹é¡¹ç›®çš„æœ€ä½³å®è·µï¼
